
<!DOCTYPE html>
<html lang="" class="loading">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>廖锡洪</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="viabcde,"> 
    
    <meta name="author" content="viacbde"> 
    <link rel="alternative" href="atom.xml" title="廖锡洪" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head>
</html>
<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">Docker</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class="main">
        <h1 class="title">Docker</h1>
        <div class="stuff">
            <span>十月 28, 2018</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Docker/">Docker</a><span class="post-tags-list-count">1</span></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/标签/">标签</a><span class="post-tags-list-count">162</span></li></ul>


        </div>
        <div class="content markdown">
            <h2 id="Docker的三个概念"><a href="#Docker的三个概念" class="headerlink" title="Docker的三个概念"></a><strong>Docker的三个概念</strong></h2><h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a><strong>Image</strong></h3><p>Docker 镜像和java的类类似，不可改动，只有安装后作为容器（对应类似java的实例）才能改动  </p>
<h3 id="container"><a href="#container" class="headerlink" title="container"></a><strong>container</strong></h3><p>容器是Image的一个实例，有点像面向对象里new 一个实例。容器类似于一个轻量级的沙盒，Docker利用容器来运行和隔离应用。容器从Image启动时，Docker会在镜像的最上层创建一个可写层，镜像本身保持不变。    </p>
<h3 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a><strong>Repository</strong></h3><p> Docker 仓库是存放镜像的地方。（不要把Docker的仓库和注册服务器Registry混淆注册服务器是存放仓库的地方，每个仓库存放某一类不同标签Tag的镜像。） </p>
<h2 id="优点：Docker利用容器将资源进行有效隔离"><a href="#优点：Docker利用容器将资源进行有效隔离" class="headerlink" title="优点：Docker利用容器将资源进行有效隔离"></a><strong>优点：Docker利用容器将资源进行有效隔离</strong></h2><p><strong>缺点：安全运营与管理，以及具有保密性、完整性和可用性的通用控件的支持</strong></p>
<h2 id="docker简介"><a href="#docker简介" class="headerlink" title="docker简介"></a><strong>docker简介</strong></h2><p>虚拟机的虚拟化技术依赖物理CPU和内存，是硬件级别的；<br>docker构建在操作系统上，利用操作系统的containerization技术，所以docker甚至可以在虚拟机上运行。  </p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a><strong>背景</strong></h3><p>运行环境的不统一与需要针对不同系统进行多次配置，影响了开发  </p>
<h3 id="docker设想"><a href="#docker设想" class="headerlink" title="docker设想"></a><strong>docker设想</strong></h3><p>用户可以通过标准化手段自由组装运行环境，可以由用户自定义，也可以由专业人员制造。这样，交付一个软件，就是一系列标准化组件的集合的交付。    </p>
<h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a><strong>解决方法：</strong></h3><p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，进行测试运行，然后发布到任何流行的Linux机器上，从而统一了环境，不用针对不同系统的环境进行多次测试，而且启动一个容器是秒级别的，不用手动配置和安装依赖。  </p>
<h3 id="额外好处："><a href="#额外好处：" class="headerlink" title="额外好处："></a><strong>额外好处：</strong></h3><p>Docker应用间隔离，不易产生依赖冲突，在同一台机器上运行多个配置不同的容器。在更细的粒度上进行资源的管理，比虚拟化技术性能更高，更加节约资源。  </p>
<h2 id="用户应用程序迁往Docker容器的五个基本步骤"><a href="#用户应用程序迁往Docker容器的五个基本步骤" class="headerlink" title="用户应用程序迁往Docker容器的五个基本步骤"></a><strong>用户应用程序迁往Docker容器的五个基本步骤</strong></h2><p>通过设计和部署把这些服务拆分成为它们自己的容器。<br>（如果一个应用程序能够被拆分成为越多的分布式组件：<br>好处：应用程序扩展的选择越多。<br>坏处：分布式组件越多也意味着管理的复杂性越高。  </p>
<h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a><strong>第一步</strong></h3><p>搜索Docker注册库找到一个<strong>基本的Docker映像</strong>作为应用程序的基础来使用   </p>
<h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a><strong>第二步</strong></h3><p>更新较老的应用程序以支持联合身份管理方法，<strong>为每一个应用程序组件和数据提供一个唯一的标识符</strong>，在一个细粒度的级别上进行安全性管理。然后<strong>增加日志记录</strong>的方法。  </p>
<h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a><strong>第三步</strong></h3><p>使用一个Dockerfile来定义映像开发的必要步骤。一旦创建了映像，就将其<strong>添加至Docer Hub</strong>  </p>
<h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a><strong>第四步</strong></h3><p><strong>对在容器中应用程序进行配置</strong>，让应用程序知道在哪里连接外部资源或者应用程序集群中的其他容器。  </p>
<h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a><strong>第五步</strong></h3><p>对基于容器的应用程序的测试和对其他分布式应用程序的<strong>测试</strong>一样，首先对每个容器进行组件测试，然后对容器集群作为一个整体进行测试。 确定应用程序应如何能够在负载增加的前提下进行扩展。如果用户正在使用一个集群管理器（例如Swarm），则可测试其性能。<br>最后，把容器<strong>部署到实际生产环境</strong>中。为了积极主动地关注基于容器的应用程序的运行状况，可考虑实施必要的监控和管理机制。确保打开日志记录功能     </p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a><strong>安装Docker</strong></h2><p><a href="https://www.docker.com/" target="_blank" rel="noopener">https://www.docker.com/</a><br>官网上有各种平台的详细安装过程。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Docker的安装</span><br><span class="line">1.安装条件:</span><br><span class="line">   64位CPU架构. </span><br><span class="line">   内核版本为3.10及以上的Linux系统. </span><br><span class="line">   开启cgroup和namespace功能</span><br><span class="line">2.开始安装: 用sudo权限或者切换root用户,</span><br><span class="line">   通过yum安装 :</span><br><span class="line">$ sudo yum install docker-engine </span><br><span class="line">   通过脚本安装:</span><br><span class="line">$ curl -fsSL https://get.docker.com/ | sh</span><br><span class="line">3.以daemon方式开启docker服务:</span><br><span class="line">$ sudo service docker start</span><br><span class="line">4.验证安装是否成功:</span><br><span class="line"> $ sudo docker run hello-world</span><br><span class="line">5.建议: 由于docker daemon 必须用root/sudo权限运行,为避免每次使用sudo,可创建一个具有root权限的docker组，并将用户添加到该组。</span><br><span class="line">6.将docker服务加入系统启动项:</span><br><span class="line">$ sudo chkconfig docker on</span><br></pre></td></tr></table></figure></p>
<h2 id="Docker基本用法"><a href="#Docker基本用法" class="headerlink" title="Docker基本用法"></a><strong>Docker基本用法</strong></h2><p>Docker的默认服务器是hub.docker.com 他目前是最大的镜像网站，由于国情原因下载上边的镜像，实在是慢的让人受不了，可以搜一下国内的镜像网站我是用的这个（不是给这个网站做广告，确实挺下载快多了）<a href="https://hub.tenxcloud.com/" target="_blank" rel="noopener">https://hub.tenxcloud.com/</a>  </p>
<h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a><strong>拉取镜像</strong></h3><p>$ docker pull centos # 获取 centos 官方镜像  </p>
<h3 id="指定国内的镜像地址"><a href="#指定国内的镜像地址" class="headerlink" title="指定国内的镜像地址"></a><strong>指定国内的镜像地址</strong></h3><p>$ docker pull index.tenxcloud.com/tenxcloud/centos:centos7  指定国内的镜像下载地址<br>后边的：centos7是tag，表明我想下载的版本是cent0s7  </p>
<h3 id="查看现有镜像"><a href="#查看现有镜像" class="headerlink" title="查看现有镜像"></a><strong>查看现有镜像</strong></h3><p>docker images<br><img src="https://viabcde.github.io/images/2018-10-10/2018101020.png" alt="enter description
here"> </p>
<h3 id="运行container"><a href="#运行container" class="headerlink" title="运行container"></a><strong>运行container</strong></h3><p>我们来运行下载好的centos7<br>docker run -i -t 6e75 /bin/bash<br>docker run       - 运行一个容器<br>-t                        - 分配一个（伪）tty<br>-i                        - 交互模式<br>6e75                - Image Id 我只输入了前几位，  </p>
<pre><code>- 只要能标识出唯一就行  
</code></pre><p>/bin/bash         - 运行命令 bash shell<br><img src="https://viabcde.github.io/images/2018-10-10/2018101021.png" alt="enter description
here"><br>运行完命令后我们就已经进入了centos7容器，可以执行linux命令试一下。<br>如果要退出输入exit即可。<br>退出后容器也相应停止，如果想要在后台继续运行可以加可选参数 -d<br>docker run -i -t -d 6e75 /bin/bash  </p>
<h3 id="查看哪些容器在运行"><a href="#查看哪些容器在运行" class="headerlink" title="查看哪些容器在运行"></a><strong>查看哪些容器在运行</strong></h3><p>docker ps # 会列出在运行的<br><img src="https://viabcde.github.io/images/2018-10-10/2018101022.png" alt="enter description
here"> </p>
<h3 id="在已存在的容器上运行命令"><a href="#在已存在的容器上运行命令" class="headerlink" title="在已存在的容器上运行命令"></a><strong>在已存在的容器上运行命令</strong></h3><p>如上边截图我们的centos7容器在运行，想在这个容器里运行命令可以用exec命令<br>docker exec -t -i 875c /bin/bash<br><img src="https://viabcde.github.io/images/2018-10-10/2018101023.png" alt="enter description
here"> </p>
<h2 id="Docker-命令帮助"><a href="#Docker-命令帮助" class="headerlink" title="Docker 命令帮助"></a><strong>Docker 命令帮助</strong></h2><p>$ sudo docker   # docker 命令帮助<br>Commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">    attach    Attach to a running container                 # 当前 shell 下 attach 连接指定运行镜像</span><br><span class="line"></span><br><span class="line">    build     Build an image from a Dockerfile              # 通过 Dockerfile 定制镜像</span><br><span class="line"></span><br><span class="line">    commit    Create a new image from a container&apos;s changes # 提交当前容器为新的镜像</span><br><span class="line"></span><br><span class="line">    cp        Copy files/folders from the containers filesystem to the host path</span><br><span class="line"></span><br><span class="line">              # 从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line"></span><br><span class="line">    create    Create a new container                        # 创建一个新的容器，同 run，但不启动容器</span><br><span class="line"></span><br><span class="line">    diff      Inspect changes on a container&apos;s filesystem   # 查看 docker 容器变化</span><br><span class="line"></span><br><span class="line">    events    Get real time events from the server          # 从 docker 服务获取容器实时事件</span><br><span class="line"></span><br><span class="line">    exec      Run a command in an existing container        # 在已存在的容器上运行命令</span><br><span class="line"></span><br><span class="line">    export    Stream the contents of a container as a tar archive  </span><br><span class="line"></span><br><span class="line">              # 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span><br><span class="line"></span><br><span class="line">    history   Show the history of an image                  # 展示一个镜像形成历史</span><br><span class="line"></span><br><span class="line">    images    List images                                   # 列出系统当前镜像</span><br><span class="line"></span><br><span class="line">    import    Create a new filesystem image from the contents of a tarball </span><br><span class="line"></span><br><span class="line">              # 从tar包中的内容创建一个新的文件系统映像[对应 export]</span><br><span class="line"></span><br><span class="line">    info      Display system-wide information               # 显示系统相关信息</span><br><span class="line"></span><br><span class="line">    inspect   Return low-level information on a container   # 查看容器详细信息</span><br><span class="line"></span><br><span class="line">    kill      Kill a running container                      # kill 指定 docker 容器</span><br><span class="line"></span><br><span class="line">    load      Load an image from a tar archive              # 从一个 tar 包中加载一个镜像[对应 save]</span><br><span class="line"></span><br><span class="line">    login     Register or Login to the docker registry server  </span><br><span class="line"></span><br><span class="line">              # 注册或者登陆一个 docker 源服务器</span><br><span class="line"></span><br><span class="line">    logout    Log out from a Docker registry server         # 从当前 Docker registry 退出</span><br><span class="line"></span><br><span class="line">    logs      Fetch the logs of a container                 # 输出当前容器日志信息</span><br><span class="line"></span><br><span class="line">    port      Lookup the public-facing port which is NAT-ed to PRIVATE_PORT</span><br><span class="line"></span><br><span class="line">              # 查看映射端口对应的容器内部源端口</span><br><span class="line"></span><br><span class="line">    pause     Pause all processes within a container        # 暂停容器</span><br><span class="line"></span><br><span class="line">    ps        List containers                               # 列出容器列表</span><br><span class="line"></span><br><span class="line">    pull      Pull an image or a repository from the docker registry server</span><br><span class="line"></span><br><span class="line">              # 从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line"></span><br><span class="line">    push      Push an image or a repository to the docker registry server</span><br><span class="line"></span><br><span class="line">              # 推送指定镜像或者库镜像至docker源服务器</span><br><span class="line"></span><br><span class="line">    restart   Restart a running container                   # 重启运行的容器</span><br><span class="line"></span><br><span class="line">    rm        Remove one or more containers                 # 移除一个或者多个容器</span><br><span class="line"></span><br><span class="line">    rmi       Remove one or more images                 </span><br><span class="line"></span><br><span class="line">              # 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span><br><span class="line"></span><br><span class="line">    run       Run a command in a new container</span><br><span class="line"></span><br><span class="line">              # 创建一个新的容器并运行一个命令</span><br><span class="line"></span><br><span class="line">    save      Save an image to a tar archive                # 保存一个镜像为一个 tar 包[对应 load]</span><br><span class="line"></span><br><span class="line">    search    Search for an image on the Docker Hub         # 在 docker hub 中搜索镜像</span><br><span class="line"></span><br><span class="line">    start     Start a stopped containers                    # 启动容器</span><br><span class="line"></span><br><span class="line">    stop      Stop a running containers                     # 停止容器</span><br><span class="line"></span><br><span class="line">    tag       Tag an image into a repository                # 给源中镜像打标签</span><br><span class="line"></span><br><span class="line">    top       Lookup the running processes of a container   # 查看容器中运行的进程信息</span><br><span class="line"></span><br><span class="line">    unpause   Unpause a paused container                    # 取消暂停容器</span><br><span class="line"></span><br><span class="line">    version   Show the docker version information           # 查看 docker 版本号</span><br><span class="line"></span><br><span class="line">    wait      Block until a container stops, then print its exit code  </span><br><span class="line"></span><br><span class="line">              # 截取容器停止时的退出状态值</span><br><span class="line">Docker之常用命令</span><br><span class="line">查看docker信息</span><br><span class="line">#查看docker版本</span><br><span class="line">$ docker version</span><br><span class="line">#查看docker系统信息</span><br><span class="line">$ docker info</span><br><span class="line">对镜像的操作</span><br><span class="line"># 检索image  </span><br><span class="line">$ docker search image_name  </span><br><span class="line"># 下载image  </span><br><span class="line">$ docker pull image_name  </span><br><span class="line"># 列出镜像列表; -a, --all=false Show all images; --no-trunc=false Don&apos;t truncate output; -q, --quiet=false Only show numeric IDs</span><br><span class="line">$ docker images  </span><br><span class="line"># 删除一个或者多个镜像; -f, --force=false Force; --no-prune=false Do not delete untagged parents  </span><br><span class="line">$ docker rmi image_name  </span><br><span class="line"># 显示一个镜像的历史; --no-trunc=false Don&apos;t truncate output; -q, --quiet=false Only show numeric IDs</span><br><span class="line">$ docker history image_name  </span><br><span class="line">启动容器</span><br><span class="line"># 在容器中运行&quot;echo&quot;命令，输出&quot;hello word&quot;  </span><br><span class="line">$ docker run image_name echo &quot;hello word&quot;  </span><br><span class="line"># 交互式进入容器中  </span><br><span class="line">$ docker run -i -t image_name /bin/bash  </span><br><span class="line"># 在容器中安装新的程序  </span><br><span class="line">$ docker run image_name apt-get install -y app_name</span><br><span class="line"># 在运维中普遍使用的docker命令 </span><br><span class="line">$ docker run --name titan-showcase -p 8480:8080 -v /u01/titan-showcase/download:/home/titan-showcase/download  -e TZ=Asia/Shanghai  --restart=always -d titan-showcase:0.1.47</span><br><span class="line">注意： 在执行apt-get 命令的时候，要带上-y参数。如果不指定-y参数的话，apt-get命令会进入交互模式，需要用户输入命令来进行确认，但在docker环境中是无法响应这种交互的。apt-get 命令执行完毕之后，容器就会停止，但对容器的改动不会丢失。</span><br><span class="line">查看容器</span><br><span class="line"># 列出当前所有正在运行的container  </span><br><span class="line">$ docker ps </span><br><span class="line"># 列出所有的container  </span><br><span class="line">$ docker ps -a  </span><br><span class="line"># 列出最近一次启动的container </span><br><span class="line">$ docker ps -l  </span><br><span class="line">对容器的操作</span><br><span class="line"># 删除所有容器  </span><br><span class="line">$ docker rm `docker ps -a -q`  </span><br><span class="line"># 删除单个容器; -f, --force=false; -l, --link=false Remove the specified link and not the underlying container; -v, --volumes=false Remove the volumes associated to the container</span><br><span class="line">$docker rm Name/ID  </span><br><span class="line"># 停止、启动、杀死一个容器</span><br><span class="line">$ docker stop Name/ID  </span><br><span class="line">$ docker start Name/ID  </span><br><span class="line">$ docker kill Name/ID  </span><br><span class="line"># 从一个容器中取日志; -f, --follow=false Follow log output; -t, --timestamps=false Show timestamps</span><br><span class="line">$docker logs Name/ID</span><br><span class="line"># 使用比较广泛的读取docker容器日志的后一千行信息的命令</span><br><span class="line">$ docker logs -f --tail=1000 Name/ID</span><br><span class="line"># 列出一个容器里面被改变的文件或者目录，list列表会显示出三种事件，A 增加的，D 删除的，C 被改变的</span><br><span class="line">$ docker diff Name/ID  </span><br><span class="line"># 显示一个运行的容器里面的进程信息  </span><br><span class="line">$ docker top Name/ID  </span><br><span class="line"># 从容器里面拷贝文件/目录到本地一个路径</span><br><span class="line">$ docker cp Name:/container_path to_path</span><br><span class="line">$ docker cp ID:/container_path to_path  </span><br><span class="line"># 重启一个正在运行的容器; -t, --time=10 Number of seconds to try to stop for before killing the container, Default=10  </span><br><span class="line">$ docker restart Name/ID  </span><br><span class="line"># 附加到一个运行的容器上面; --no-stdin=false Do not attach stdin; --sig-proxy=true Proxify all received signal to the process  </span><br><span class="line">$ docker attach ID  </span><br><span class="line">保存和加载镜像</span><br><span class="line">当需要把一台机器上的镜像迁移到另一台机器的时候，需要保存镜像与加载镜像。</span><br><span class="line"># 保存镜像到一个tar包; -o, --output=&quot;&quot; Write to an file </span><br><span class="line">$ docker save image_name:image_version -o file_path</span><br><span class="line"># 加载一个tar包格式的镜像; -i, --input=&quot;&quot; Read from a tar archive file  </span><br><span class="line">$ docker load -i file_path  </span><br><span class="line"># 机器a  </span><br><span class="line">$ docker save image_name:image_version &gt; /home/save.tar</span><br><span class="line">或</span><br><span class="line">$ docker save -o /home/save.tar image_name:image_version</span><br><span class="line"># 使用scp将save.tar拷到机器b上，然后：</span><br><span class="line">$ docker load -i &lt; /home/save.tar</span><br><span class="line">登录registry server</span><br><span class="line"># 登陆registry server; -e, --email=&quot;&quot; Email; -p, --password=&quot;&quot; Password; -u, --username=&quot;&quot; Username  </span><br><span class="line">$ docker login</span><br><span class="line">发布镜像</span><br><span class="line"># 发布docker镜像  </span><br><span class="line">$ docker push new_image_name</span><br><span class="line">根据dockerfile构建镜像</span><br><span class="line">#build  </span><br><span class="line">      --no-cache=false Do not use cache when building the image  </span><br><span class="line">      -q, --quiet=false Suppress the verbose output generated by the containers  </span><br><span class="line">      --rm=true Remove intermediate containers after a successful build  </span><br><span class="line">      -t, --tag=&quot;&quot; Repository name (and optionally a tag) to be applied to the resulting image in case of success </span><br><span class="line">$ docker build -t image_name:image_version Dockerfile_path </span><br><span class="line">运维中一个比较典型的dockerfile文件示例</span><br><span class="line">FROM changan/java:1.8</span><br><span class="line">MAINTAINER xxx</span><br><span class="line"># set timezone to PRC</span><br><span class="line">ENV TZ=&quot;Asia/Shanghai&quot; LANG=en_US.UTF-8  PRO_ENV=&quot;prod&quot;</span><br><span class="line">ADD build/libs/xxx-0.0.1.jar /home/App.jar</span><br><span class="line">ENTRYPOINT java -jar /home/App.jar</span><br></pre></td></tr></table></figure>
<h2 id="Docker的使用"><a href="#Docker的使用" class="headerlink" title="Docker的使用"></a>Docker的使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">1.基本使用命令:</span><br><span class="line">   查看docker环境:</span><br><span class="line"> $ docker info</span><br><span class="line">2.查看docker命令:</span><br><span class="line">   所有命令:</span><br><span class="line">$ docker </span><br><span class="line">   某条命令:</span><br><span class="line">$ docker xxx --help</span><br><span class="line">3.启动一次性运行的容器(并在容器中执行命令):</span><br><span class="line">$ docker run ubuntu:16.04 /bin/echo &apos;Hello world&apos;</span><br><span class="line">4.启动交互模式容器:</span><br><span class="line">$ docker run -t-i ubuntu:16.04 (-t:开启一个终端, -i:以交互模式运行)</span><br><span class="line">5.启动后台模式容器:</span><br><span class="line">$ docker run -d ubuntu:14.04 /bin/sh (-d:以后台Daemon方式运行，执行成功后会返回一个该容器的ID)</span><br><span class="line">6.指定容器启动后的名字:</span><br><span class="line">$ docker run -i -t --name mytest ubuntu:14.04 /bin/bash (--name:指定启动后的容器名字,如果不指定则docker会帮我们取一个名字)</span><br><span class="line">7.以映射端口方式启动一个Web容器:</span><br><span class="line">$ docker run -d -P (-P:端口映射，外部端口到容器端口的映射规则由docker负责) </span><br><span class="line">$ docker run -d -p 5000:5000 (-p:自己指定端口映射规则，格式为:-p ip:host port:port，将当前物理机的ip的端口映射到容器的端口) </span><br><span class="line"># 查看到其端口列的端口映射规则</span><br><span class="line">$ docker ps -l</span><br><span class="line"># 容器ID或容器名称 可快捷查看容器的端口</span><br><span class="line">$ docker port</span><br><span class="line">8.查看容器的具体信息:</span><br><span class="line">$ docker inspect 容器ID或容器名称</span><br><span class="line">9.对运行着的后台容器进入执行命令:</span><br><span class="line">$ docker exec -it 容器ID /bin/bash</span><br><span class="line">10.查看容器的日志:</span><br><span class="line"> $ docker logs -f 容器ID或容器名称 (-f:以滚动的形式查看日志)</span><br><span class="line">11.重启容器:</span><br><span class="line">$ docker restart 容器ID</span><br><span class="line">12.暂停容器:</span><br><span class="line"> $ docker pause 容器ID / $ docker unpause 容器ID</span><br><span class="line">13.停止容器:</span><br><span class="line">$ docker stop 容器ID或容器名称</span><br><span class="line">14.杀死容器:</span><br><span class="line">$ docker kill 容器ID或容器名称</span><br><span class="line">15.删除容器:</span><br><span class="line">$ docker rm 容器ID或容器名称 (正在运行的容器不能删除)</span><br><span class="line">16.把一个宿主机上的目录挂载到镜像里:</span><br><span class="line">$ docker run -it -v /home/dock/Downloads:/usr/Downloads ubuntu64 /bin/bash (-v:冒号前为宿主机目录，必须为绝对路径，冒号后为镜像内挂载的路径) </span><br><span class="line"># 默认挂载的路径权限为读写。</span><br><span class="line"># 如果指定为只读可以用ro: </span><br><span class="line">$ docker run -it -v /home/dock/Downloads:/usr/Downloads:ro ubuntu64 /bin/bash</span><br><span class="line">17.一个容器定义的一个数据挂载信息。其他的容器启动可以直接挂载数据卷容器中定义的挂载信息:</span><br><span class="line">$ docker run -v /home/dock/Downloads:/usr/Downloads --name dataVol ubuntu64 /bin/bash </span><br><span class="line">$ docker run -it --volumes-from dataVol ubuntu64 /bin/bash </span><br><span class="line">(--volumes-from:用来指定要从哪个数据卷来挂载数据)</span><br></pre></td></tr></table></figure>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="true">
                <source type="audio/mpeg" src="/music/1.mp3">
            </audio>
            
        </div>
        
    <div id="gitalk-container" class="comment link" data-ae="false" data-ci="55316b017b800ec5c0da" data-cs="fbe9f4aafee144a34ec283ca34c833ad6da91507" data-r="talk" data-o="viacbde" data-a="viabcde" data-d="false">查看评论</div>


    </div>
    
        <div class="side">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker的三个概念"><span class="toc-number">1.</span> <span class="toc-text">Docker的三个概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Image"><span class="toc-number">1.1.</span> <span class="toc-text">Image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#container"><span class="toc-number">1.2.</span> <span class="toc-text">container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Repository"><span class="toc-number">1.3.</span> <span class="toc-text">Repository</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优点：Docker利用容器将资源进行有效隔离"><span class="toc-number">2.</span> <span class="toc-text">优点：Docker利用容器将资源进行有效隔离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker简介"><span class="toc-number">3.</span> <span class="toc-text">docker简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#背景"><span class="toc-number">3.1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker设想"><span class="toc-number">3.2.</span> <span class="toc-text">docker设想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决方法："><span class="toc-number">3.3.</span> <span class="toc-text">解决方法：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#额外好处："><span class="toc-number">3.4.</span> <span class="toc-text">额外好处：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用户应用程序迁往Docker容器的五个基本步骤"><span class="toc-number">4.</span> <span class="toc-text">用户应用程序迁往Docker容器的五个基本步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步"><span class="toc-number">4.1.</span> <span class="toc-text">第一步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步"><span class="toc-number">4.2.</span> <span class="toc-text">第二步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步"><span class="toc-number">4.3.</span> <span class="toc-text">第三步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四步"><span class="toc-number">4.4.</span> <span class="toc-text">第四步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第五步"><span class="toc-number">4.5.</span> <span class="toc-text">第五步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Docker"><span class="toc-number">5.</span> <span class="toc-text">安装Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker基本用法"><span class="toc-number">6.</span> <span class="toc-text">Docker基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#拉取镜像"><span class="toc-number">6.1.</span> <span class="toc-text">拉取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#指定国内的镜像地址"><span class="toc-number">6.2.</span> <span class="toc-text">指定国内的镜像地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看现有镜像"><span class="toc-number">6.3.</span> <span class="toc-text">查看现有镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行container"><span class="toc-number">6.4.</span> <span class="toc-text">运行container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看哪些容器在运行"><span class="toc-number">6.5.</span> <span class="toc-text">查看哪些容器在运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在已存在的容器上运行命令"><span class="toc-number">6.6.</span> <span class="toc-text">在已存在的容器上运行命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-命令帮助"><span class="toc-number">7.</span> <span class="toc-text">Docker 命令帮助</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker的使用"><span class="toc-number">8.</span> <span class="toc-text">Docker的使用</span></a></li></ol>
        </div>
    
</div>


    </div>
</div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>